# Данные фиксированного размера

# 3. Как проектировать программы

**Упражнение 33**. Почитайте о проблеме «2000 года».

## 3.1. Проектирование функций

### Информация и данные

*Предметная область* программы - информация из области реального мира.

*Информация* - это факты о предметной области программы.

Чтобы программа могла обрабатывать информацию, она должна преобразовать ее
в некоторую форму представления *данных* на языке программирования,
затем обработать эти данные и по завершении преобразовать полученные
данные в информацию.

Надо решить как на выбранном языке программирования представлять
соответствующие фрагменты информации в виде данных и как ин-
терпретировать данные при их преобразовании в информацию:

![Рис. 4. Преобразование информации в данные и данных в информацию](/doc/ch03/pic01.png)

*Определения данных* - комментарии (знания), как перейти от чисел-информации
к числам-данным и наоборот.

*Класс* - набор данных.

Пример определения данных:

```text
; Температура -- это число.
; интерпретация: число выражает температуру в градусах Цельсия
```

*Сигнатура функции* - комментарий, сообщающий:

- сколько входных параметров принимает функция
- каким классам они принадлежат
- какие данные эта функция производит.

Примеры:

```text
// на входе – строка, на выходе – число:
; Строка -> Число

// на входе – температура, на выходе – строка:
; Температура -> Строка

// на входе число, строка и изображение:
; Число Строка Изображение -> Изображение
```

*Описание назначения* функции - короткий ответ на вопрос:
"Что вычисляет эта функция?"

*Заголовок* - это упрощенное определение функции.

### Процесс проектирования

Процесс проектирования каждой отдельной функции:

1. Выразить представление информации в виде данных.

Для этого достаточно однострочного комментария:

```text
; Мы обозначаем числами длину в сантиметрах.
```

Сформулировать определения классов данных, которые считаются критически
важными для программы.

2. Записать сигнатуру, описание назначения и заголовок функции.

  Пример:

  ```rkt
  ; Число Строка Изображение -> Изображение
  ; добавляет строку s в изображение img,
  ; с отступом в y пикселей от верхнего края и 10 -- от левого края
  (define (add-image y s img)
  ```

3. Привести пример применения функции или написать тест.

  Выбрать по одному экземпляру данных каждого входного класса из
  сигнатуры и показать, каким должен быть результат.

  Пример:

  ```rkt
  ; Число -> Число
  ; вычисляет площадь квадрата со стороной len
  ; дано: 2, ожидаемый результат: 4
  ; дано: 7, ожидаемый результат: 49
  (define (area-of-square len) 0)
  ```

4. Сделать *макет* функции:

  Пример:

  ```rkt
  (define (area-of-square len)
    (... len ...))
  ```

  где `(... len ...))` - "болванка", пустое тело.

5. Написание *кода* функции. Замена тела функции выражением, которое
использует элементы макета и вычисляет то, о чем говорится в описании
назначения.

  Пример:

  ```rkt
  ; Число -> Число
  ; вычисляет площадь квадрата со стороной len
  ; дано: 2, ожидаемый результат: 4
  ; дано: 7, ожидаемый результат: 49
  (define (area-of-square len)
    (sqr len))
  ```

6. Проверка работы функции на ранее придуманных примерах:

  ```rkt
  (area-of-square 2)    ; 4
  (area-of-square 7)    ; 49
  ```

Если ошибки при проверках то:

a) ошибка в расчетах и неверное определение ожидаемых результатов

b) определение функции содержит ошибку и дает неверный результат (bug)

c) ошибки имеют место и в примерах и в определении функции.

## 3.2. Практические упражнения: функции

*Примечание: для описания примеров здесь буду сразу использовать тесты из раздела 3.5*.

**Упражнение 34**. Спроектируйте функцию `string-first`,
которая извлекает первый символ (`1String`) из непустой строки.
Считайте пока, что функция никогда не будет получать пустые строки.

[ex034.rkt](/src/ch02/ex034.rkt)

**Упражнение 35**. Спроектируйте функцию `string-last`,
которая извлекает последний символ (`1String`) из непустой строки.

[ex035.rkt](/src/ch02/ex035.rkt)

**Упражнение 36**. Спроектируйте функцию `image-area`,
которая подсчитывает количество пикселей в заданном изображении.

[ex036.rkt](/src/ch02/ex036.rkt)

**Упражнение 37**. Спроектируйте функцию `string-rest`,
которая создает строку, подобную данной, но без первого символа.

[ex037.rkt](/src/ch02/ex037.rkt)

**Упражнение 38**. Спроектируйте функцию `string-remove-last`,
которая создает строку, подобную данной, но без последнего символа.

[ex038.rkt](/src/ch02/ex038.rkt)

## 3.3. Знание предметной области

Чтобы определить тело функции, необходимо знать и понимать предметную область
программы.

Существует 2 формы знания *предметной области:*

1. Знания из внешних предметных областей.
(математика, музыка, экономика и т.д.).

2. Знание библиотечных функций, доступных в выбранном языке программирования.

## 3.4. От функций к программам

Рекомендуется создать и сохранить список необходимых функций для реализации
требуемого функционала программы.

Каждый элемент в списке должен включать:

- описательное имя функции
- сигнатуру функции
- описание назначения.

Создание программы рекомендуется делать так:

- Для *неинтерактивной* программы, начать с добавления главной
функции в список необходимых функций.

- Для *интерактивной* программы, можно начать с добавления в список
обработчиков событий, функции `stop-when` и функции `scene-rendering`.

- Приступить к проектированию главной функции.

- Если во время проектирования обнаружится, что нужна еще одна функция,
добавить ее в список.

- Пока список не опустеет, выбирать из него очередной элемент и проектировать
функцию.

- Когда список необходимых функций опустеет, программа будет готова.

## 3.5. О тестировании

Тестирование – это самый главный инструмент для обнаружения и устранения
недостатков.

Важно автоматизировать тестирование, чтобы не проводить его вручную.

В книге показывается и используется *модульное тестирование*.

Пример. Определена и реализована функция

```rkt
; Число -> Число
; преобразует температуру по Фаренгейту в температуру по Цельсию
; дано: 32, ожидаемый результат: 0
; дано: 212, ожидаемый результат: 100
; дано: -40, ожидаемый результат: -40
(define (f2c f)
  (* 5/9 (- f 32)))
```

В книге тесты записываются вместо текстовых примеров и автоматически
запускаются:

```rkt
; Число -> Число
; преобразует температуру по Фаренгейту в температуру по Цельсию

(check-expect (f2c -40) -40)
(check-expect (f2c 32) 0)
(check-expect (f2c 212) 100)

(define (f2c f)
  (* 5/9 (- f 32)))
```

[05_auto_testing_exampl.rkt](/src/ch02/05_auto_testing_exampl.rkt)

`check-expect` также может выполнять проверки с изображениями,
то есть позволяет протестировать функции, создающие изображения.

## 3.6. Проектирование интерактивных программ

1. Создать константы для всех постоянных свойств мира.

  a) "физические" константы  - описывают общие атрибуты объектов в мире
  (скорость, цвет, высота, ширина, радиус, ...)

  b) графические константы - изображения предметов в мире
  (могут вычисляться на основе предыдущих).

2. Определить данные с описанием, как информация о мире преобразуется
в данные и как данные интерпретируются в информацию о мире.

3. Спроектировать ряд функций.

  - Функция, преобразующая любое заданное состояние в изображение.
  Пример: `render`.

  - Какие события будут изменять те или иные аспекты состояния мира.
  Пример: `clock-tick-handler`, `keystroke-handler`, `mouse-event-handler`.

  - Состояние, после достижения которго программа должна остановиться.
  Пример: `end?`.

4. Определить главную функцию (`main`).
Единственное ее предназначение - возможность запуска программы.

**Упражнение 39**. Создать изображение автомобиля `CAR`. Его размер
определяется относительно размера колес: `(define WHEEL-RADIUS 5)`.

[ex039.rkt](/src/ch02/ex039.rkt)

**Упражнение 40**.
Оформить примеры функций движения автомобиля в виде тестов `check-expect`.

**Упражнение 41**.
Завершить пример и запустить программу движения автомобиля.

[ex040-041.rkt](/src/ch02/ex040-041.rkt)
