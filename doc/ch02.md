# Данные фиксированного размера

## 1. Арифметика

### 2.1. Функции

**Определение константы**:

```txt
(define Переменная Выражение)
```

**Определение функции**:

```txt
(define (ИмяФункции Переменная ... Переменная)
    Выражение)
```

Количество переменных определяет количество входных данных,
также называемых *аргументами* или *параметрами*.

*Унарная* функция - функция с одним аргументом.

*Бинарная* функция - функция с двумя аргументами.

*Тернарная* функция - функция с тремя аргументами.

*Выражение* (оно же *тело*) определяет результат.

**Упражнение 11**. Определите функцию, которая принимает два
числа, `x` и `y`, и вычисляет расстояние от точки `(x, y)` до начала координат.

[ex011.rkt](/src/ch02/ex011.rkt)

**Упражнение 12**. Определите функцию `cvolume`, которая принимает
длину ребра куба и вычисляет его объем. Определите функцию
`csurface`, вычисляющую площадь поверхности куба.

[ex012.rkt](/src/ch02/ex012.rkt)

**Упражнение 13**. Определите функцию `string-first`, которая
извлекает первый символ (`1String`) из непустой строки.

[ex013.rkt](/src/ch02/ex013.rkt)

**Упражнение 14**. Определите функцию `string-last`, которая
извлекает последний символ (`1String`) из непустой строки.

[ex014.rkt](/src/ch02/ex014.rkt)

**Упражнение 15**. Определите функцию `==>`. Она должна принимать
два логических значения (пусть это будут параметры с именами `sunny`
и `friday`) и возвращать `#true`, если `sunny` имеет ложное значение или
`friday` - истинное.

[ex015.rkt](/src/ch02/ex015.rkt)

**Упражнение 16**. Определите функцию `image-area`, которая подсчитывает
количество пикселей в заданном изображении.

[ex016.rkt](/src/ch02/ex016.rkt)

**Упражнение 17**. Определите функцию `image-classify`, которая
принимает изображение и возвращает:

* "tall" (высокое), если высота изображения больше ширины;
* "wide" (широкое), если высота изображения меньше ширины
* и "square" (квадратное), если ширина равна высоте.

[ex017.rkt](/src/ch02/ex017.rkt)

**Упражнение 18**. Определите функцию `string-join`, которая принимает
две строки и объединяет их в одну строку, добавляя символ `_`
между ними.

[ex018.rkt](/src/ch02/ex018.rkt)

**Упражнение 19**. Определите функцию `string-insert`, которая принимает
строку `str` и число `i` и вставляет `_` в `i-ю` позицию строки `str`.
Предполагается, что `i` - это число в диапазоне от 0 до длины заданной
строки (включительно).

[ex019.rkt](/src/ch02/ex019.rkt)

**Упражнение 20**. Определите функцию `string-delete`, которая принимает
строку `str` и число `i` и удаляет из `str` символ в `i-й` позиции.
Предполагается, что `i` - это число в диапазоне от 0 до длины данной
строки (не включая).

[ex020.rkt](/src/ch02/ex020.rkt)

### 2.2. Вычисления

**Упражнение 21**. Используйте движок пошаговых вычислений в DrRa­cket,
чтобы увидеть, как вычисляется выражение `(ff (ff 1))`.
Также попробуйте выражение `(+ (ff 1) (ff 1))`.

```rkt
(define (ff a)
    (* 10 a))
```

[ex021.rkt](/src/ch02/ex021.rkt)

**Упражнение 22**. Используйте движок пошаговых вычислений
в DrRa­cket, чтобы увидеть, как выполняется следующий
фрагмент программы:

```rkt
(define (distance-to-origin x y)
  (sqrt (+ (sqr x)
           (sqr y))))
```

[ex022.rkt](/src/ch02/ex022.rkt)

**Упражнение 23**. Первый символ (`1String`) в строке "hello world" –
буква "h". Как следующая функция вычисляет этот результат?

```rkt
(define (string-first s)
  (substring s 0 1))
```

[ex023.rkt](/src/ch02/ex023.rkt)

**Упражнение 24**. Есть определение функции `==>`.
С помощью движка пошаговых вычислений определите значение выражения
`(==> #true #false)`.

```rkt
(define (==> x y)
  (or (not x) y))
```

[ex024.rkt](/src/ch02/ex024.rkt)

**Упражнение 25**. Взгляните на попытку решить упражнение 17.
Помогает ли пошаговое выполнение применения функции предложить исправление?

```rkt
(require 2htdp/image)

(define (image-classify img)   ; Не совсем правильная реализация
  (cond
    [(>= (image-height img)
         (image-width img))
     "tall"]
    [(= (image-height img)
        (image-width img))
     "square"]
    [(<= (image-height img)
         (image-width img))
     "wide"]))
```

[ex025.rkt](/src/ch02/ex025.rkt)

**Упражнение 26**. Какое значение вернет программа
`(string-insert "helloworld" 6)`.
Подтвердите свои рассуждения с по­мощью движка пошаговых вычислений.

```rkt
(define (string-insert s i)
  (string-append (substring s 0 i)
                 "_"
                 (substring s i)))
```

[ex026.rkt](/src/ch02/ex026.rkt)

### 2.3. Композиция функций

Подавляющее большинство программ состоит из определения *главной функции*
и множества определений других функций, и практически всегда результат
одной функции передается на вход другой функции.
По аналогии с алгеброй мы называем такой способ определения
функций *композицией*, а дополнительные функции -
*вспомогательными функциями*.

Пример. Программа, которая формирует шаблон письма.

[01_letter_template.rkt](/src/ch02/01_letter_template.rkt)

Там используется модуль `2htdp/batch-io` чтобы вывести сформированную
строку письма в консоль при помощи функции `write-file`:

```rkt
(require 2htdp/batch-io)

(define (letter fst lst signature-name)
  ...

(define (opening fst)
  ...
(define (body fst lst)
  ...
(define (closing signature-name)
  ...

(write-file 'stdout (letter "Matthew" "Fisler" "Felleisen"))
(write-file 'stdout (letter "Kathi" "Felleisen" "Findler"))
```

Простое правило:

>**Определяйте отдельную функцию для каждой задачи.**

**Упражнение 27**.
Владелец монопольного кинотеатра устанавливает цены на билеты.
Чем выше цена, тем меньше людей могут позволить себе купить билеты.
Чем ниже цена, тем больше затраты на показ из-за высокой посещаемости.
Есть зависимость между ценой билета и средней посещаемостью.
Используя зависимость (описана в книге) вычислить оптимальную цену билета.
Решить проблему с использованием констант.

**Упражнение 28**.
Определить потенциальную прибыль для следующих цен на билеты:
1, 2, 3, 4 и 5 долларов.
При какой цене прибыль кинотеатра получится больше всего?
Определить лучшую цену билета до цента.

**Упражнение 29**.
Затраты на билеты были оптимизированы.
Определить потенциальную прибыль для цен на билеты:
3, 4 и 5 долларов.
Сравнить результаты.

[ex027-029.rkt](/src/ch02/ex027-029.rkt)

### 2.4. Глобальные константы

Константа - это, по сути, *глобальная переменная*, а ее определение
называется *определением константы*.

Примеры:

```rkt
; текущая стоимость билета на сеанс:
(define CURRENT-PRICE 5)

; удобно использовать для вычисления площади круга:
(define ALMOST-PI 3.14)

; пустая строка:
(define NL "\n")

; пустая сцена:
(define MT (empty-scene 100 100))

(define WIDTH 100)
(define HEIGHT 200)

(define MID-WIDTH (/ WIDTH 2))
(define MID-HEIGHT (/ HEIGHT 2))
```

По соглашению (в книге) в именах глобальных констант мы используем только
прописные буквы.

**Упражнение 30**.
Определите константы в программе оптимизации цен на билеты в кинотеатре,преобразовав изменение посещае­мости в зависимости от изменения цены
(15 человек на каждые 10 центов) в константу.

[ex030.rkt](/src/ch02/ex030.rkt)

### 2.5. Программы

С точки зрения выполнения программы делятся на:

* *Пакетные программы*. Получают сразу все свои входные данные и вычисляют
результат.

* *Интерактивные программы*. Получают лишь часть своих входных данных,
выполняют вычисления и производят некоторые выходные данные, затем получают
дополнительные данные и т. д.
Появление дополнительных данных - *событие*.
Главная функция такой программы, управляемой событиями, использует выражение,
чтобы описать, какие функции вызывать для тех или иных типов
событий - *обработчики событий*.

#### Пакетные программы

Пакетные программы на основе файлов можно создавать с использованием
библиотеки `2htdp/batch-io`:

* `read-file`, читает содержимое файла и представляет его как строку;

  * `read-file` может принимать токен 'stdin вместо имени файла и читать
    данные, вводимые с клавиатуры.

* `write-file`, создает файл и записывает в него указанную строку.

  * Результатом `write-file` является подтверждение, что строка помещена
    в файл.
  * Если файл уже существует, его содержимое будет затерто заданной строкой;
    в противном случае функция создаст файл и запишет в него данную строку.
  * `write-file` может принимать в первом аргументе особый токен `'stdout`.
    В этом случае вывод будет осуществляться на экран, в области
    взаи­модействий.

Примеры:

```rkt
> (write-file "sample.dat" "212")
"sample.dat"

> (read-file "sample.dat")
"212"

(write-file 'stdout "212\n")
212
'stdout
```

Пример. Программа, читает температуру по Фаренгейту из файла,
преобразует ее в температуру по Цельсию и выводит результат
в другой файл.

[02_to_celsius.rkt](/src/ch02/02_to_celsius.rkt)

**Упражнение 31**.
Основа - программа `letter` из раздела 2.3.
Здесь пример пакетной программы, составляющей заготовки писем, которая
читает имена из трех разных файлов и сохраняет письмо в четвертом файле.
Создать соответствующие файлы, запустить главную функцию main.
Проверить, выводит ли программа ожидаемое письмо в заданный файл.

[ex031.rkt](/src/ch02/ex031.rkt)

#### Интерактивные программы

**Упражнение 32**. Можно пропустить.

Пример 1. Программа. Рисует квадрат в отдельном окне, который уменьшается.
При нажатии любой кнопки восстанавливает свой размер.

[03_big_bang_square.rkt](/src/ch02/03_big_bang_square.rkt)

Используется функция `big-bang` из `2htdp/universe`.
Для рисования используется `square` из `2htdp/image`.

Пример 2. Интерактивная программа. Рисует точку внизу окна.
Точка плавно поднимается вверх и останавливается в самом верху.
По нажатии любой клавиши прекращение подъема точки.

[04_place_dot_at.rkt](/src/ch02/04_place_dot_at.rkt)
